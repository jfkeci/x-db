---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import Header from '../../components/Header.astro';
import { SITE_TITLE } from '../../consts';

export async function getStaticPaths() {
	const exercises = await getCollection('exercises');
	return exercises.map((exercise) => ({
		params: { slug: exercise.id },
		props: exercise,
	}));
}

type Props = CollectionEntry<'exercises'>;

const exercise = Astro.props;
const { Content } = await render(exercise);

const categoryIcons: Record<string, string> = {
	'Strength': 'üí™',
	'Cardio': '‚ù§Ô∏è',
	'Core': 'üéØ',
	'Flexibility': 'üßò',
	'Compound': 'üèãÔ∏è',
};

const difficultyColors: Record<string, string> = {
	'Beginner': 'bg-green-500/20 text-green-300 border-green-500/30',
	'Intermediate': 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30',
	'Advanced': 'bg-red-500/20 text-red-300 border-red-500/30',
};
---

<html lang="en">
	<head>
		<BaseHead title={`${exercise.data.name} | ${SITE_TITLE}`} description={exercise.data.description} />
	</head>

	<body class="min-h-screen flex flex-col bg-gradient-to-br from-purple-700 via-pink-600 to-orange-500 dark:from-gray-900 dark:via-purple-900 dark:to-gray-900 transition-colors duration-500">
		<!-- Animated background blobs -->
		<div class="fixed inset-0 overflow-hidden pointer-events-none">
			<div class="absolute -top-40 -left-40 w-80 h-80 bg-purple-400 dark:bg-purple-600 rounded-full mix-blend-multiply dark:mix-blend-soft-light filter blur-3xl opacity-70 animate-blob"></div>
			<div class="absolute top-40 -right-40 w-80 h-80 bg-yellow-300 dark:bg-pink-600 rounded-full mix-blend-multiply dark:mix-blend-soft-light filter blur-3xl opacity-70 animate-blob animation-delay-2000"></div>
			<div class="absolute -bottom-40 left-1/2 w-80 h-80 bg-pink-400 dark:bg-blue-600 rounded-full mix-blend-multiply dark:mix-blend-soft-light filter blur-3xl opacity-70 animate-blob animation-delay-4000"></div>
		</div>

		<Header />

		<main class="relative z-10 max-w-4xl mx-auto px-4 pt-24 pb-12 flex-1">
			<!-- Back link -->
			<a href={`${import.meta.env.BASE_URL}/exercises`} class="inline-flex items-center gap-2 text-white/70 hover:text-white mb-6 transition-colors">
				<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
				</svg>
				Back to Exercises
			</a>

			<article class="glass-card rounded-3xl overflow-hidden">
				<div class="p-6 md:p-10">
					<!-- Header -->
					<div class="mb-8">
						<div class="flex flex-wrap items-center gap-3 mb-4">
							<span class="text-4xl">{categoryIcons[exercise.data.category]}</span>
							<span class="glass px-3 py-1 rounded-full text-sm font-medium text-white/80">
								{exercise.data.category}
							</span>
							<span class={`px-3 py-1 rounded-full text-sm font-medium border ${difficultyColors[exercise.data.difficulty]}`}>
								{exercise.data.difficulty}
							</span>
						</div>
						<h1 class="text-3xl md:text-4xl font-bold text-white mb-4">{exercise.data.name}</h1>
						<p class="text-lg text-white/70">{exercise.data.description}</p>
					</div>

					<!-- Meta info -->
					<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
						<div class="glass rounded-2xl p-4">
							<h3 class="text-white/60 text-sm mb-2">Muscle Groups</h3>
							<div class="flex flex-wrap gap-2">
								{exercise.data.muscleGroups.map((muscle) => (
									<span class="bg-white/10 px-3 py-1 rounded-lg text-sm text-white">
										{muscle}
									</span>
								))}
							</div>
						</div>
						{exercise.data.equipment && exercise.data.equipment.length > 0 && (
							<div class="glass rounded-2xl p-4">
								<h3 class="text-white/60 text-sm mb-2">Equipment Needed</h3>
								<div class="flex flex-wrap gap-2">
									{exercise.data.equipment.map((item) => (
										<span class="bg-white/10 px-3 py-1 rounded-lg text-sm text-white">
											{item}
										</span>
									))}
								</div>
							</div>
						)}
					</div>

					<!-- Content -->
					<div class="prose prose-lg max-w-none text-white/90
						prose-headings:text-white prose-headings:font-bold
						prose-h2:text-2xl prose-h2:mt-8 prose-h2:mb-4
						prose-h3:text-xl prose-h3:mt-6 prose-h3:mb-3
						prose-p:mb-4 prose-p:leading-relaxed
						prose-a:text-white prose-a:underline prose-a:underline-offset-2 hover:prose-a:text-white/80
						prose-strong:text-white prose-strong:font-semibold
						prose-ul:my-4 prose-ul:list-disc prose-ul:pl-6
						prose-ol:my-4 prose-ol:list-decimal prose-ol:pl-6
						prose-li:mb-2 prose-li:text-white/80
						prose-hr:border-white/20 prose-hr:my-8">
						<Content />
					</div>
				</div>
			</article>
		</main>

		<Footer />

		<style>
			@keyframes blob {
				0% { transform: translate(0px, 0px) scale(1); }
				33% { transform: translate(30px, -50px) scale(1.1); }
				66% { transform: translate(-20px, 20px) scale(0.9); }
				100% { transform: translate(0px, 0px) scale(1); }
			}
			.animate-blob {
				animation: blob 7s infinite;
			}
			.animation-delay-2000 {
				animation-delay: 2s;
			}
			.animation-delay-4000 {
				animation-delay: 4s;
			}
		</style>
	</body>
</html>
